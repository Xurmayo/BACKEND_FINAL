<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A La Pierre ‚Äî Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
body { background:#f7f5f2; }
.red-nav { background:#8b0000; }

.admin-card {
    border-radius:18px;
    border:none;
    box-shadow:0 15px 35px rgba(0,0,0,.1);
}

.red-footer { background:#8b0000; }
</style>
</head>

<body class="d-flex flex-column min-vh-100">

<!-- NAVBAR -->
<nav class="navbar navbar-dark red-nav shadow-sm">
<div class="container">

<span class="navbar-brand">üçΩÔ∏è Admin Dashboard</span>

<div class="d-flex gap-2">
<a href="index.html" class="btn btn-outline-light">
<i class="bi bi-house"></i> Home
</a>

<button onclick="logout()" class="btn btn-outline-light">
<i class="bi bi-box-arrow-right"></i> Logout
</button>
</div>

</div>
</nav>


<!-- CONTENT -->
<section class="container py-5">
<div class="row g-4 justify-content-center">

<!-- CATEGORY -->
<div class="col-md-5">
<div class="card admin-card p-4">
<h4>Create Category</h4>

<input id="catName" class="form-control mb-3" placeholder="Category Name">
<input id="catDesc" class="form-control mb-3" placeholder="Description">

<button onclick="createCategory()" class="btn btn-danger w-100 rounded-pill">
Add Category
</button>
</div>
</div>

<!-- MENU ITEM -->
<div class="col-md-5">
<div class="card admin-card p-4">
<h4>Create Menu Item</h4>

<input id="itemName" class="form-control mb-3" placeholder="Item Name">
<input id="price" class="form-control mb-3" placeholder="Price" type="number">
<textarea id="description" class="form-control mb-3" placeholder="Description"></textarea>
<input id="categoryId" class="form-control mb-3" placeholder="Category ID">
<input id="imageUrl" class="form-control mb-3" placeholder="Image URL">

<button onclick="addItem()" class="btn btn-danger w-100 rounded-pill">
Add Menu Item
</button>
</div>
</div>

<!-- MESSAGES PANEL -->
<div class="col-12">
<div class="card admin-card p-4">

<h4 class="mb-3">üì¨ Messages</h4>

<div id="messagesList" class="list-group small">
Loading messages...
</div>

</div>
</div>

<!-- RESERVATIONS PANEL -->
<div class="col-12">
<div class="card admin-card p-4">

<h4 class="mb-3">üìÖ Reservations</h4>

<div id="reservationsList" class="list-group small">
Loading reservations...
</div>

</div>
</div>

</div>
</section>

<footer class="red-footer text-white mt-auto">
<div class="container text-center py-3 small">
¬© 2026 A La Pierre
</div>
</footer>

<script>

const token = localStorage.getItem("token");

if (!token){
 alert("Login first");
 window.location.href="login.html";
}

/* LOGOUT */
function logout(){
 localStorage.removeItem("token");
 window.location.href="login.html";
}

/* CREATE CATEGORY */
async function createCategory(){

 const res = await fetch("/api/categories",{
   method:"POST",
   headers:{
     "Content-Type":"application/json",
     "Authorization":`Bearer ${token}`
   },
   body:JSON.stringify({
     name:catName.value,
     description:catDesc.value
   })
 });

 const data = await res.json();

 if(!res.ok) return alert(data.error);

 alert("Category created!");
}

/* ADD MENU ITEM */
async function addItem(){

 try{
   const res = await fetch("/api/menu",{
     method:"POST",
     headers:{
       "Content-Type":"application/json",
       "Authorization":`Bearer ${token}`
     },
     body:JSON.stringify({
       name:itemName.value,
       price:Number(price.value),
       description:description.value,
       category:categoryId.value,
       imageUrl:imageUrl.value
     })
   });

   const data = await res.json();

   if(!res.ok) throw new Error(data.error);

   alert("Menu Item Added!");

 }catch(err){
   alert(err.message);
 }
}

/* LOAD MESSAGES */
async function loadMessages(){

 const res = await fetch("/api/messages",{
   headers:{ Authorization:`Bearer ${token}` }
 });
 const messages = await res.json();

 const box = document.getElementById("messagesList");
 box.innerHTML="";

 if(messages.length===0){
   box.innerHTML="<div class='text-muted'>No messages yet</div>";
   return;
 }

 messages.forEach(msg=>{

   const item=document.createElement("div");
   item.className="list-group-item";

   item.innerHTML=`
     <div class="d-flex justify-content-between">

       <div>
         <strong>${msg.subject}</strong>
         <div class="small text-muted">${msg.name} ‚Ä¢ ${msg.email}</div>
         <div class="small mt-1">${msg.message}</div>
       </div>

       <div class="text-end">

         <span class="badge ${msg.status==="unread" ? "bg-danger":"bg-success"}">
           ${msg.status}
         </span>

         <div class="mt-2">

           ${msg.status==="unread"
           ? `<button class="btn btn-sm btn-outline-success"
                 onclick="markRead('${msg._id}')">
                 Mark Read
              </button>`
           : ""}

           <button class="btn btn-sm btn-outline-danger mt-1"
             onclick="deleteMessage('${msg._id}')">
             Delete
           </button>

         </div>
       </div>

     </div>
   `;

   box.appendChild(item);
 });
}

/* MARK MESSAGE READ */
async function markRead(id){
 await fetch(`/api/messages/${id}/read`,{
   method:"PATCH",
   headers:{ Authorization:`Bearer ${token}` }
 });
 loadMessages();
}

/* DELETE MESSAGE */
async function deleteMessage(id){

 if(!confirm("Delete message?")) return;

 await fetch(`/api/messages/${id}`,{
   method:"DELETE",
   headers:{ Authorization:`Bearer ${token}` }
 });
 loadMessages();
}

/* LOAD RESERVATIONS */
async function loadReservations(){

 const res = await fetch("/api/reservations",{
   headers:{ Authorization:`Bearer ${token}` }
 });
 const reservations = await res.json();

 const box=document.getElementById("reservationsList");
 box.innerHTML="";

 if(reservations.length===0){
   box.innerHTML="<div class='text-muted'>No reservations</div>";
   return;
 }

 reservations.forEach(r=>{

   const item=document.createElement("div");
   item.className="list-group-item";

   item.innerHTML=`
     <div class="d-flex justify-content-between">

       <div>
         <strong>${r.user?.email || "Unknown user"}</strong>
         <div class="small">üìÖ ${r.date}</div>
         <div class="small">‚è∞ ${r.time}</div>
         <div class="small">üë• Guests: ${r.guests}</div>
       </div>

       <button class="btn btn-sm btn-outline-danger"
         onclick="deleteReservation('${r._id}')">
         Cancel
       </button>

     </div>
   `;

   box.appendChild(item);
 });
}

/* DELETE RESERVATION */
async function deleteReservation(id){

 if(!confirm("Cancel reservation?")) return;

 await fetch(`/api/reservations/${id}`,{
   method:"DELETE",
   headers:{ Authorization:`Bearer ${token}` }
 });

 loadReservations();
}

/* LOAD DATA */
loadMessages();
loadReservations();

</script>

</body>
</html>
